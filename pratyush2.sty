\ProvidesPackage{pratyush2}[2021/07/23 Personal style file, version 2]

% Import amssymb and mathtools (disable if using mathdesign)
\newif\ifpratyush@amsfonts\pratyush@amsfontstrue
% Theorems (amsthm)
\newif\ifpratyush@thm\pratyush@thmtrue
% Theorem, lemma, etc. numbering by default
\newif\ifpratyush@thmnums\pratyush@thmnumstrue
% Definition numbering by default
\newif\ifpratyush@defnnums\pratyush@defnnumsfalse
% Include auxiliary theorem environments
\newif\ifpratyush@thmaux\pratyush@thmauxtrue
% Colored boxes around theorem environments
\newif\ifpratyush@thmboxed\pratyush@thmboxedfalse
% Asymptote
\newif\ifpratyush@asy\pratyush@asytrue
% Linear algebra macros
\newif\ifpratyush@linalg\pratyush@linalgfalse

\DeclareOption{noamsfonts}{\pratyush@amsfontsfalse}
\DeclareOption{nothm}{\pratyush@thmfalse}
\DeclareOption{thmnonums}{\pratyush@thmnumsfalse}
\DeclareOption{defnnums}{\pratyush@defnnumstrue}
\DeclareOption{thmaux}{\pratyush@thmauxfalse}
\DeclareOption{thmboxed}{\pratyush@thmboxedtrue}
\DeclareOption{noasy}{\pratyush@asyfalse}
\DeclareOption{linalg}{\pratyush@linalgtrue}

\ProcessOptions\relax

% Standard package imports and config {{{
\RequirePackage[T1]{fontenc}
\ifpratyush@amsfonts
	\RequirePackage{lmodern}
\fi

\RequirePackage{microtype}
\RequirePackage{hyphsubst}
\HyphSubstLet{english}{usenglishmax}
\RequirePackage[english]{babel}
% https://tex.stackexchange.com/a/27743

\RequirePackage{amsmath}
\ifpratyush@amsfonts
	\RequirePackage{amssymb, mathtools}
\fi

\RequirePackage[colorlinks]{hyperref}
\RequirePackage{array, booktabs, multirow, longtable}

\RequirePackage[shortlabels, inline]{enumitem}
\setenumerate[2]{label=(\alph*)}

\ifpratyush@asy
	\RequirePackage[inline]{asymptote}
\fi

\RequirePackage[dvipsnames]{xcolor}

\RequirePackage{fancyvrb}
\VerbatimFootnotes
% https://tex.stackexchange.com/a/209

\RequirePackage{xparse}
% }}}

% Theorem environments {{{
\ifpratyush@thm
	\RequirePackage{amsthm, thmtools}
	\theoremstyle{definition}

	\ifpratyush@thmboxed
		\usepackage[framemethod=TikZ]{mdframed}

		% \pratyush@newthmstyle {{{
		% Inspired by evan.sty
		% https://github.com/vEnhance/dotfiles/blob/main/texmf/tex/latex/evan/evan.sty
		\NewDocumentCommand \pratyush@newthmstyle {mmm} {
			% #1: name of box ("thm#1box" will be used)
			% #2: outline/heading color
			% #3: background color
			\mdfdefinestyle{md#1box}{%
				linewidth = 1pt,
				% Using \addvspace works after section headers while the
				% `skipabove` option does not
				beforesingleframe = {\addvspace{12pt}},
				innerbottommargin = 9pt,
				skipbelow = 2pt,
				linecolor = #2,
				nobreak = true,
				backgroundcolor = #3,
			}
			\declaretheoremstyle[
				headfont = {\sffamily\bfseries\color{#2}},
				mdframed = {style=md#1box},
				headpunct = {\\[3pt]},
			]{thm#1box}
		}
		% }}}

		\pratyush@newthmstyle{blue}{blue}{TealBlue!5}
		\pratyush@newthmstyle{red}{RawSienna}{Salmon!5}
		\pratyush@newthmstyle{green}{ForestGreen}{ForestGreen!5}
		\pratyush@newthmstyle{black}{black}{RedViolet!5!gray!5}

		\newcommand\pratyush@thmstyle@thm{thmbluebox}
		\newcommand\pratyush@thmstyle@defn{thmgreenbox}
		\newcommand\pratyush@thmstyle@remark{thmredbox}

		\newcommand\vocab[1]{\textbf{\color{blue}#1}}
	\else
		\newcommand\pratyush@thmstyle@thm{definition}
		\newcommand\pratyush@thmstyle@defn{definition}
		\newcommand\pratyush@thmstyle@remark{definition}
		\newcommand\vocab[1]{\emph{#1}}
	\fi

	% \pratyush@declaretheorem {{{
	\ExplSyntaxOn
	\NewDocumentCommand \pratyush@declaretheorem {omoo} {
		% #1: name of command (part after "\pratyush@") used to determine
		% numbering (if not given, numbering is always disabled)
		% #2: name of environment
		% #3: name of command (part after "\pratyush@thmstyle@") used to
		% determine styling
		% #4: name of heading (defaults to name of environment with capital
		% first letter)

		% Name of theorem style (from \declaretheoremstyle)
		\IfNoValueTF {#3} {
			\tl_set:Nn \l_tmpa_tl {definition}
		} {
			\tl_if_blank:nTF {#3} {
				\tl_set:Nn \l_tmpa_tl {definition}
			} {
				\tl_set:Nn \l_tmpa_tl {\cs:w pratyush@thmstyle@#3 \cs_end:}
			}
		}

		\IfNoValueTF {#1} {
			% Disable numbering
			\bool_set_false:N \l_tmpa_bool
		} {
			\tl_if_blank:nTF {#1} {
				% Disable numbering
				\bool_set_false:N \l_tmpa_bool
			}
			\cs:w ifpratyush@#1 \cs_end:
				\bool_set_true:N \l_tmpa_bool
			\else
				\bool_set_false:N \l_tmpa_bool
			\fi
		}

		\IfNoValueTF {#4} {
			% Determine heading name by uppercasing first letter of environment
			% name
			\tl_set:Nn \l_tmpb_tl {
				\str_uppercase:f {\str_head:n {#2}}
				\str_tail:n {#2}
			}
		} {
			\tl_set:Nn \l_tmpb_tl {#4}
		}

		\bool_if:NTF \l_tmpa_bool {
			% Number the environment like `theorem`, unless this environment is
			% `theorem`
			\tl_if_eq:nnTF {#2} {theorem} {
				\declaretheorem[style=\l_tmpa_tl, name=\l_tmpb_tl]{#2}
			} {
				\declaretheorem[
					style=\l_tmpa_tl, name=\l_tmpb_tl, sibling=theorem
				]{#2}
			}
			% Starred version
			\declaretheorem[style=\l_tmpa_tl, name=\l_tmpb_tl, numbered=no]{#2*}
		} {
			% No numbering
			\declaretheorem[style=\l_tmpa_tl, name=\l_tmpb_tl, numbered=no]{#2}
		}
	}
	\ExplSyntaxOff
	% }}}

	\pratyush@declaretheorem[thmnums]{theorem}[thm]
	\pratyush@declaretheorem[thmnums]{proposition}[thm]
	\pratyush@declaretheorem[thmnums]{lemma}[thm]

	\pratyush@declaretheorem[defnnums]{definition}[defn]

	\ifpratyush@thmaux
		\pratyush@declaretheorem{remark}[remark]
		\pratyush@declaretheorem{claim}[remark]
		\pratyush@declaretheorem{fact}[remark]
		\pratyush@declaretheorem{example}[remark]
		\pratyush@declaretheorem{solution}
	\fi

	\input{pratyush2_namedthm.sty}
\fi
% }}}

% Abbreviated syntax for bmatrix
% From Harvard Math 21b (fall 2020)
\newcommand\bmat[1]{\ensuremath{\begin{bmatrix}#1\end{bmatrix}}}

% Linear algebra macros
\ifpratyush@linalg
	\input{pratyush2_linalg.sty}
\fi

\let\emptyset\varnothing

\newcommand\todo[1]{\textbf{\color{red}(TODO: #1)}}

% Roman numerals
% https://tex.stackexchange.com/a/23492
\newcommand*\rom[1]{\text{\expandafter\@slowromancap\romannumeral #1@}}

% Extended references (e.g. \eref{lemma:mylemma}{Lemma} creates "Lemma 1" where
% both words together form a hyperlink)
\newcommand\eref[2]{\hyperref[#1]{#2 \ref*{#1}}}

% Similar to \hfill but in display math
% https://tex.stackexchange.com/a/83522
\newcommand{\pushright}[1]{%
	\ifmeasuring@#1\else\omit\hfill$\displaystyle#1$\fi\ignorespaces%
}
\newcommand{\pushleft}[1]{%
	\ifmeasuring@#1\else\omit$\displaystyle#1$\hfill\fi\ignorespaces%
}

\allowdisplaybreaks

\author{Pratyush Venkatakrishnan}
% vim: set fdm=marker:
